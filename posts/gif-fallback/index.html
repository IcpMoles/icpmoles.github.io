<!doctype html><html lang=en-en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>The unrequested GIF | Mole of Moles</title>
<meta property="fediverse:creator" content=icpmoles@mastodon.social><link rel=stylesheet href=../../css/bundle.min.de176905b1c7b9a14546dbb72841d1f8a7b77e00ea40c1eed907d49842375e2d.css integrity="sha256-3hdpBbHHuaFFRtu3KEHR+Ke3fgDqQMHu2QfUmEI3Xi0=" crossorigin=anonymous><script type=module src=https://icpmoles.github.io/js/relative-time-element.min.js integrity></script><script>function openLightbox(e,t){let n=document.getElementById("lb-"+t);n.showModal();let s=n.querySelector("img"),o=parseInt(s.getAttribute("width")),i=parseInt(s.getAttribute("height"));n.dataset.eventAttached!="1"&&n.addEventListener("click",e=>{let t=n.getBoundingClientRect();n.dataset.eventAttached="1",e.clientX<t.left||e.clientX>t.right||e.clientY<t.top||e.clientY>t.bottom?(n.className="",s.className="dialogimg",n.close()):o>i?n.className==""?(s.classList.add("dialogimg-ev"),n.className="dialogcontainer-ev"):(n.className="",s.className="dialogimg"):n.className==""?(s.classList.add("dialogimg-eh"),n.className="dialogcontainer-eh"):(s.className="dialogimg",n.className="")})}</script></head><body><header><h1>N<sub>A</sub> of Moles</h1><nav><ul><li><a href=../../>Home</a></li><li><a aria-current=true class=ancestor href=../../posts/>Posts</a></li><li><a href=../../tags/>Tags</a></li></ul></nav></header><main><article><h1>The unrequested GIF</h1><time datetime=2021-10-05T15:41:17+02:00>October 5, 2021</time><p>While developing my GIF shortcode for Hugo I stumbled upon a weird behaviour from various browsers.</p><p>The story<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup><sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> goes like: If you want to use videos instead of GIFs to save on bandwith for your users you can just use something like:</p><div class=codeblock><div class="codelang codeIcon">html</div><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>video</span> <span class=na>autoplay</span> <span class=na>loop</span> <span class=na>muted</span> <span class=na>playsinline</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>source</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;cat.webm&#34;</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;video/webm&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>source</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;cat.mp4&#34;</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;video/mp4&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>img</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;cat.gif&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>video</span><span class=p>&gt;</span></span></span></code></pre></div></div><p>The <code>&lt;img src="cat.gif"/></code> will behave like a fallback for browsers not supporting the <code>video</code> element or the provided formats. Just use ffmpeg to convert GIFs to MP4 and/or webm and you will have a couple of decades of video encoders developement to show animated cats in the fastest way possible.</p><p>But no, even if your noble intents to show animated cats to your visitors while saving their bandwith seem completed there is a problem:</p><p>With the code showed above <mark>all the browsers will download the video file AND the gif file</mark>, throwing outside the window your bandwith saving intents and making it worse because you&rsquo;re forcing your visitors to download an additional file, no matter how small it is.</p><p><a href="https://www.w3schools.com/code/tryit.asp?filename=GV5OL2D67MVS">You can try it directly</a></p><p><figure><picture><source type=image/webp srcset=https://icpmoles.github.io/posts/gif-fallback/devtools_huce1221fb55224bc1832b121d0344faba_313615_1440x1440_fit_q95_h2_box_3.webp><source type=image/jpeg srcset="https://icpmoles.github.io/posts/gif-fallback/devtools_huce1221fb55224bc1832b121d0344faba_313615_720x720_fit_q75_bgffffff_box_3.jpg 1x, 2x"><img class=post-img src=https://icpmoles.github.io/posts/gif-fallback/devtools_huce1221fb55224bc1832b121d0344faba_313615_720x720_fit_q75_bgffffff_box_3.jpg alt="Notice the programming.gif file being downloaded before the video file" loading=lazy width=944 height=1273 onclick=openLightbox(this,0)></picture><figcaption class=small>Notice the programming.gif file being downloaded before the video file</figcaption></figure><dialog id=lb-0><img class=dialogimg src=https://icpmoles.github.io/posts/gif-fallback/devtools_huce1221fb55224bc1832b121d0344faba_313615_0x0_q95_h2__3.webp loading=lazy width=944 height=1273></dialog></p><p>As you see in the screen above the browser still downloads the &ldquo;fallback&rdquo; GIF.</p><p>This behaviour doesn&rsquo;t seem widely reported in the &ldquo;use videos instead of gifs&rdquo; guides, staying relegated to some StackOverflow discussions <sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup><sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>.</p><p>How should you resolve this?</p><ol><li><p>Don&rsquo;t provide an <code>&lt;img></code>, just link to the GIF and ask them to update the browser to something more &ldquo;modern&rdquo;.<sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup></p><div class=codeblock><div class="codelang codeIcon">html</div><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>video</span> <span class=na>autoplay</span> <span class=na>loop</span> <span class=na>muted</span> <span class=na>playsinline</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>source</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;cat.webm&#34;</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;video/webm&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>source</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;cat.mp4&#34;</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;video/mp4&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span>In case you browser doesn&#39;t support video files open the <span class=p>&lt;</span><span class=nt>a</span> <span class=na>target</span><span class=o>=</span><span class=s>&#34;_blank&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;cat.gif&#34;</span><span class=p>&gt;</span>GIF<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span> in another page<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>video</span><span class=p>&gt;</span> </span></span></code></pre></div></div></li><li><p>Fix stuff server side, check the UA and provide the <code>&lt;video></code> instead of the <code>&lt;img></code> or viceversa depending on it. If your content is statically rendered then it won&rsquo;t work.</p></li><li><p>The <code>&lt;!--[if lt IE 9]></code><sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup>. This will work because the only main browsers not supporting the <code>video</code> elements are the <a href=https://caniuse.com/video>Internet Explorer previous to the 9th and Opera Mini</a>. Your code will just be</p><div class=codeblock><div class="codelang codeIcon">html</div><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>video</span> <span class=na>autoplay</span> <span class=na>loop</span> <span class=na>muted</span> <span class=na>playsinline</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>source</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;cat.webm&#34;</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;video/webm&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>source</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;cat.mp4&#34;</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;video/mp4&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=c>&lt;!--[if lt IE 9]&gt;&lt;img src=&#34;cat.gif&#34;/&gt;&lt;![endif]--&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>video</span><span class=p>&gt;</span> </span></span></code></pre></div></div></li><li><p>No GIF fallback. Really. At the time of writing those IE versions account for a 0,06% of the broswer share. Opera Mini is a bit more used (1,19%) but I think that CanIUse uses the UA to calculate the browser usage regardless of the type of data saving enabled, while for the tests it uses the aggressive server rendering option. In the worst case scenario the 1,25% of your visitors will have a degraded experience without the animated cats. Being more realistics I will say that even before the lack of animated cats those 1,25% will have a bad time in 2021 to reach your website between expired certificates, unsupported protocols, etc. (Try downloading an <a href=https://ftp.mozilla.org/pub/firefox/releases/>old Firefox</a> version to see it by yourself).</p></li></ol><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://www.smashingmagazine.com/2018/11/gif-to-video/>Improve Animated GIF Performance With HTML5 Video</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><a href="https://rigor.com/blog/optimizing-animated-gifs-with-html5-video/#:~:text=to%20use%20our%20new%20video%2C%20we%20need%20to%20replace%20that%20with%20this%3A">Optimizing Animated GIFs by Converting to HTML5 Video</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p><a href=https://stackoverflow.com/questions/26365401/html5-fallback-images-are-being-loaded-by-the-browser-even-though-html5-video-i>HTML5 fallback images are being loaded by the browser, even though HTML5 video is supported</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p><a href="https://stackoverflow.com/questions/63108518/best-practices-to-fall-back-to-gif-for-browsers-that-dont-support-html-5-video#:~:text=note%3A%20in%20my%20browser%20at%20least%2C%20the%20image%20inside%20is%20still%20fetched%20and%20loaded">&ldquo;Note: In my browser at least, the image inside is still fetched and loaded&rdquo;</a>&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p><a href=https://cloudinary.com/blog/reduce_size_of_animated_gifs_automatically_convert_to_webm_and_mp4#html5_video_tag_with_mp4_and_webm_sources>Reducing the Size of Animated GIFs and Converting Them to WebM or MP4 Through Automation</a>&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6><p><a href=https://stackoverflow.com/a/49809226>Keenly on StackOverflow</a>&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div><hr><div><div>Tags:</div><ul><li><a href=../../tags/gif/>Gif</a></li><li><a href=../../tags/video/>Video</a></li><li><a href=../../tags/html/>Html</a></li><li><a href=../../tags/fallback/>Fallback</a></li></ul></div></article></main><footer><p>Copyright 2024. All rights reserved.</p></footer></body></html>